CREATE TABLE HACKERS2
(HACKER_ID INT, HK_NAME VARCHAR(10))

CREATE TABLE SUBMISSIONS
(SUBMISSION_ID INT, HACKER_ID INT, CHALLENGE_ID INT, SCORE INT)

INSERT INTO HACKERS2 VALUES
(4071, 'ROSE'),
(4806, 'ANGELA'),
(26071, 'FRANK'),
(49438, 'PATRICK'),
(74842, 'LISA'),
(80305,'KIMBERLY'),
(84072,'BONNIE'),
(87868,'MICHAEL'),
(92118,'TODD'),
(95895, 'JOE')

INSERT INTO SUBMISSIONS VALUES
(67194,74842,63132,76),
(64479,74842,19797,98),
(40742,26071, 49593,20),
(17513,4806,49593,32),
(69846,80305,19797,19),
(41002, 26071, 89343, 36),
(52826,49438,49593,9),
(31093,26071,19797,2),
(81614,84072,49593,100),
(44829,26071,89343,17),
(75147,80305,49593,48),
(14115,4806,49593,76),
(6943,4071,19797,95),
(12855,4086,25917,13),
(73343,80305,49593,42),
(84264,84072,63132,0),
(9951,4071,49593,43),
(45104,49438,25917,34),
(53795,74842,19797,5),
(26363,26071,19797,29),
(10063,4071,49593,96)

go
-- Tạo bảng myTable chứa cột Max_score: nếu có nhiều hơn 1 challengeID thì nó sẽ thể hiện
-- điểm số cao nhất của challenge đó.
WITH myTable as
(SELECT H.HACKER_ID, H.HK_NAME,S.CHALLENGE_ID, MAX(SCORE) AS MAX_SCORE
FROM HACKERS2 AS H LEFT JOIN SUBMISSIONS AS S ON H.HACKER_ID = S.HACKER_ID 
GROUP BY  H.HACKER_ID, H.HK_NAME,S.CHALLENGE_ID)
-- Select các cột theo yêu cầu, nếu tổng điểm > 0
SELECT HACKER_ID, HK_NAME, SUM(MAX_SCORE) AS SUM_SCORE
FROM myTable
GROUP BY  HACKER_ID, HK_NAME
HAVING SUM(MAX_SCORE) > 0
ORDER BY SUM_SCORE DESC, HACKER_ID ASC 

-- pass in hackerank
WITH myTable as
(SELECT H.HACKER_ID, H.NAME, S.CHALLENGE_ID, MAX(SCORE) AS MAX_SCORE
FROM HACKERS AS H JOIN SUBMISSIONS AS S ON H.HACKER_ID = S.HACKER_ID 
GROUP BY H.HACKER_ID, H.NAME, S.CHALLENGE_ID)
SELECT HACKER_ID, NAME, SUM(MAX_SCORE) AS SUM_SCORE
FROM myTable
GROUP BY HACKER_ID, NAME
HAVING SUM(MAX_SCORE) > 0
ORDER BY SUM_SCORE DESC, HACKER_ID ASC ;
